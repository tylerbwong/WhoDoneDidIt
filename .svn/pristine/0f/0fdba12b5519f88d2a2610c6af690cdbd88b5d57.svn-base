package whodonedidit.gui;

import java.awt.event.ActionEvent;
import java.awt.event.KeyEvent;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.AbstractAction;
import javax.swing.JButton;
import javax.swing.JLayeredPane;
import javax.swing.JTextField;
import javax.swing.KeyStroke;
import javax.swing.event.DocumentEvent;
import javax.swing.event.DocumentListener;
import javax.swing.text.BadLocationException;
import javax.swing.text.Document;

/**
 *
 * @author Tyler Wong
 */
public class ScreenNamePanel extends javax.swing.JPanel
{

    private MainFrame frame;
    private String name;
    private static final int numButtons = 2;
    private JButton[] buttons = new JButton[2];
    private int currIndex = 0;
    private boolean isOnline;

    /**
     * Creates new form ScreenName
     */
    public ScreenNamePanel(MainFrame frame, boolean isOnline)
    {
        this.frame = frame;
        this.isOnline = isOnline;
        initComponents();
        this.buttons[0] = this.backButton;
        this.buttons[1] = this.okButton;
        this.nameField.requestFocus();
        this.buttons[1].setEnabled(false);
        LobbyAction okAction = new LobbyAction(this);
        Document document = this.nameField.getDocument();
        document.addDocumentListener(new JButtonStateController(this.buttons[1]));
        this.okButton.getInputMap(JButton.WHEN_IN_FOCUSED_WINDOW).put(KeyStroke.getKeyStroke(KeyEvent.VK_ENTER, 0), "ok");
        this.okButton.getActionMap().put("ok", okAction);
    }
    
    class LobbyAction extends AbstractAction
    {
        private ScreenNamePanel panel;
        
        public LobbyAction(ScreenNamePanel panel)
        {
            this.panel = panel;
        }

        @Override
        public void actionPerformed(ActionEvent e)
        {
            frame.removePanel(this.panel);
            frame.createLobbyPanel(isOnline, getScreenName());
        }
    }

    public void setOnline(boolean isOnline)
    {
        this.isOnline = isOnline;
    }

    public String getName()
    {
        return this.name;
    }

    public JTextField getTextField()
    {
        return this.nameField;
    }
    
    public String getScreenName()
    {
        return this.nameField.getText();
    }
    
    class JButtonStateController implements DocumentListener 
    {
        JButton button;
  
        JButtonStateController(JButton button) 
        {
            this.button = button ;
        }

        public void changedUpdate(DocumentEvent e) 
        {
            try
            {
                disableIfEmpty(e);
            }
            catch (BadLocationException ex)
            {
                Logger.getLogger(ScreenNamePanel.class.getName()).log(Level.SEVERE, null, ex);
            }
        }

        public void insertUpdate(DocumentEvent e) 
        {
            try
            {
                disableIfEmpty(e);
            }
            catch (BadLocationException ex)
            {
                Logger.getLogger(ScreenNamePanel.class.getName()).log(Level.SEVERE, null, ex);
            }
        }

        public void removeUpdate(DocumentEvent e) 
        {
            try
            {
                disableIfEmpty(e);
            }
            catch (BadLocationException ex)
            {
                Logger.getLogger(ScreenNamePanel.class.getName()).log(Level.SEVERE, null, ex);
            }
        }

        public void disableIfEmpty(DocumentEvent e) throws BadLocationException 
        {
            int length = e.getDocument().getLength();
            button.setEnabled(length > 0 
                && !e.getDocument().getText(0, length).trim().isEmpty());
        }
    }

    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents()
    {

        namePanel = new javax.swing.JPanel();
        nameField = new javax.swing.JTextField();
        titleLabel = new javax.swing.JLabel();
        backButton = new javax.swing.JButton();
        okButton = new javax.swing.JButton();
        subTitleLabel = new javax.swing.JLabel();

        setBackground(new java.awt.Color(255, 255, 255));
        setPreferredSize(new java.awt.Dimension(1024, 768));
        setSize(new java.awt.Dimension(1024, 768));

        namePanel.setBackground(new java.awt.Color(255, 255, 255));
        namePanel.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)));

        titleLabel.setBackground(new java.awt.Color(255, 255, 255));
        titleLabel.setFont(new java.awt.Font("Roboto", 0, 18)); // NOI18N
        titleLabel.setText("Enter your screen name");

        backButton.setBackground(new java.awt.Color(255, 255, 255));
        backButton.setFont(new java.awt.Font("Roboto", 0, 14)); // NOI18N
        backButton.setText("Back");
        backButton.addMouseListener(new java.awt.event.MouseAdapter()
        {
            public void mouseEntered(java.awt.event.MouseEvent evt)
            {
                backButtonMouseEntered(evt);
            }
        });
        backButton.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                backButtonActionPerformed(evt);
            }
        });
        backButton.addKeyListener(new java.awt.event.KeyAdapter()
        {
            public void keyPressed(java.awt.event.KeyEvent evt)
            {
                backButtonKeyPressed(evt);
            }
        });

        okButton.setBackground(new java.awt.Color(255, 255, 255));
        okButton.setFont(new java.awt.Font("Roboto", 0, 14)); // NOI18N
        okButton.setText("OK");
        okButton.addMouseListener(new java.awt.event.MouseAdapter()
        {
            public void mouseEntered(java.awt.event.MouseEvent evt)
            {
                okButtonMouseEntered(evt);
            }
        });
        okButton.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                okButtonActionPerformed(evt);
            }
        });
        okButton.addKeyListener(new java.awt.event.KeyAdapter()
        {
            public void keyPressed(java.awt.event.KeyEvent evt)
            {
                okButtonKeyPressed(evt);
            }
        });

        subTitleLabel.setBackground(new java.awt.Color(255, 255, 255));
        subTitleLabel.setFont(new java.awt.Font("Roboto", 0, 10)); // NOI18N
        subTitleLabel.setText("*Your screen name will make you identifiable to other players online");

        org.jdesktop.layout.GroupLayout namePanelLayout = new org.jdesktop.layout.GroupLayout(namePanel);
        namePanel.setLayout(namePanelLayout);
        namePanelLayout.setHorizontalGroup(
            namePanelLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(namePanelLayout.createSequentialGroup()
                .add(71, 71, 71)
                .add(nameField, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 245, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                .add(0, 0, Short.MAX_VALUE))
            .add(org.jdesktop.layout.GroupLayout.TRAILING, namePanelLayout.createSequentialGroup()
                .addContainerGap(53, Short.MAX_VALUE)
                .add(namePanelLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                    .add(org.jdesktop.layout.GroupLayout.TRAILING, namePanelLayout.createSequentialGroup()
                        .add(namePanelLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.TRAILING, false)
                            .add(subTitleLabel)
                            .add(namePanelLayout.createSequentialGroup()
                                .add(backButton)
                                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                .add(okButton)))
                        .add(47, 47, 47))
                    .add(org.jdesktop.layout.GroupLayout.TRAILING, namePanelLayout.createSequentialGroup()
                        .add(titleLabel)
                        .add(96, 96, 96))))
        );
        namePanelLayout.setVerticalGroup(
            namePanelLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(namePanelLayout.createSequentialGroup()
                .add(34, 34, 34)
                .add(titleLabel)
                .add(18, 18, 18)
                .add(subTitleLabel)
                .add(29, 29, 29)
                .add(nameField, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                .add(42, 42, 42)
                .add(namePanelLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                    .add(backButton)
                    .add(okButton))
                .addContainerGap(68, Short.MAX_VALUE))
        );

        org.jdesktop.layout.GroupLayout layout = new org.jdesktop.layout.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(layout.createSequentialGroup()
                .add(313, 313, 313)
                .add(namePanel, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(318, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(layout.createSequentialGroup()
                .add(227, 227, 227)
                .add(namePanel, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(256, Short.MAX_VALUE))
        );
    }// </editor-fold>//GEN-END:initComponents

    private void backButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_backButtonActionPerformed
        this.frame.removePanel(this);
        this.frame.createMainMenuPanel();
    }//GEN-LAST:event_backButtonActionPerformed

    private void okButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_okButtonActionPerformed
        this.frame.removePanel(this);
        this.frame.createLobbyPanel(this.isOnline, getScreenName());
    }//GEN-LAST:event_okButtonActionPerformed

    private void backButtonKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_backButtonKeyPressed
        switch (evt.getKeyCode())
        {
            case KeyEvent.VK_LEFT:
                if (this.currIndex == 0)
                {
                    this.buttons[this.currIndex].requestFocus();
                }
                else
                {
                    this.currIndex--;
                    this.buttons[this.currIndex].requestFocus();
                }
                break;
            case KeyEvent.VK_RIGHT:
                if (this.currIndex == numButtons - 1)
                {
                    this.buttons[this.currIndex].requestFocus();
                }
                else
                {
                    this.currIndex++;
                    this.buttons[this.currIndex].requestFocus();
                }
                break;
        }
    }//GEN-LAST:event_backButtonKeyPressed

    private void okButtonKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_okButtonKeyPressed
        switch (evt.getKeyCode())
        {
            case KeyEvent.VK_LEFT:
                if (this.currIndex == 0)
                {
                    this.buttons[this.currIndex].requestFocus();
                }
                else
                {
                    this.currIndex--;
                    this.buttons[this.currIndex].requestFocus();
                }
                break;
            case KeyEvent.VK_RIGHT:
                if (this.currIndex == numButtons - 1)
                {
                    this.buttons[this.currIndex].requestFocus();
                }
                else
                {
                    this.currIndex++;
                    this.buttons[this.currIndex].requestFocus();
                }
                break;
        }
    }//GEN-LAST:event_okButtonKeyPressed

    private void backButtonMouseEntered(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_backButtonMouseEntered
        this.buttons[0].requestFocus();
    }//GEN-LAST:event_backButtonMouseEntered

    private void okButtonMouseEntered(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_okButtonMouseEntered
        this.buttons[1].requestFocus();
    }//GEN-LAST:event_okButtonMouseEntered

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton backButton;
    private javax.swing.JTextField nameField;
    private javax.swing.JPanel namePanel;
    private javax.swing.JButton okButton;
    private javax.swing.JLabel subTitleLabel;
    private javax.swing.JLabel titleLabel;
    // End of variables declaration//GEN-END:variables
}
